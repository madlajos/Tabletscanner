<div class="auto-measurement">
  <!-- SAVE DIRECTORY -->
  <div class="save-location-row">
    <label>Mentési hely</label>
    <div class="save-location-input-group">
      <input
        type="text"
        class="styled-input save-location-input"
        [(ngModel)]="saveLocation"
        [disabled]="measurementActive"
        placeholder="Válasszon mappát..."
        readonly
      />
      <button
        type="button"
        class="browse-button"
        (click)="selectSaveFolder()"
        [disabled]="measurementActive"
      >
        ...
      </button>
    </div>
  </div>

  <!-- MEASUREMENT NAME -->
  <div class="measurement-name-row">
    <label for="measurementName">Mérés neve</label>
    <input
      id="measurementName"
      type="text"
      class="styled-input measurement-name-input"
      [(ngModel)]="measurementName"
      [disabled]="measurementActive"
      placeholder="Adja meg a mérés nevét..."
    />
  </div>

  <!-- TOGGLE BUTTONS -->
  <div class="toggle-row">
    <button
      type="button"
      class="toggle-button"
      [class.active]="autofocus"
      (click)="autofocus = !autofocus"
      [disabled]="measurementActive"
    >
      <img src="assets/SVG/auto_focus.svg" alt="Autofocus" />
      <span class="toggle-label">Autofocus</span>
    </button>

    <button
      type="button"
      class="toggle-button"
      [class.active]="lampTop"
      (click)="lampTop = !lampTop"
      [disabled]="measurementActive"
    >
      <img src="assets/SVG/ringlight_off.svg" alt="Dome light" />
      <span class="toggle-label">Felső világítás</span>
    </button>

    <button
      type="button"
      class="toggle-button"
      [class.active]="lampSide"
      (click)="lampSide = !lampSide"
      [disabled]="measurementActive"
    >
      <img src="assets/SVG/barlight_off.svg" alt="Bar light" />
      <span class="toggle-label">Súrló világítás</span>
    </button>
  </div>

  <!-- SELECTION HEADER: COUNT + CLEAR BUTTON -->
  <div class="selection-header">
    <div class="selection-count">
      Kijelölt tabletták száma:
      <span class="count">{{ selectedCount }}</span>
    </div>

    <button
      type="button"
      class="clear-button"
      (click)="clearSelection()"
      [disabled]="!hasSelection() || measurementActive"
    >
      Kijelölés törlése
    </button>
  </div>

  <!-- DOT GRID -->
  <div class="tablet-grid" (mouseleave)="onGridMouseLeave()">
    <div
      *ngFor="let id of tablets"
      class="tablet-dot"
      [class.selected]="isDotSelected(id)"
      [class.completed]="isDotCompleted(id)"
      [class.in-progress]="isDotInProgress(id)"
      [class.pending]="getDotState(id) === 'pending' && measurementActive"
      (click)="onDotClick(id)"
      (mouseenter)="onDotMouseEnter(id)"
      [title]="'Tabletta ' + id"
    >
      <span class="tablet-number">{{ id }}</span>
    </div>
  </div>

  <!-- START / STOP BUTTON FULL WIDTH -->
  <button
    class="start-button"
    [ngClass]="{ stop: measurementActive }"
    (click)="startMeasurement()"
    [disabled]="!canStart()"
  >
    {{ measurementActive ? 'Mérés leállítása' : 'Mérés indítása' }}
  </button>

  <!-- VALIDATION MESSAGE -->
  <div class="status warning" *ngIf="!measurementActive && validationMessage">
    {{ validationMessage }}
  </div>

  <!-- STATUS MESSAGES -->
  <div class="status" *ngIf="measurementActive">
    Mérés folyamatban… ({{ currentTabletIndex }}/{{ selectedCount }})
  </div>
  <div class="status success" *ngIf="!measurementActive && successMessage">
    {{ successMessage }}
  </div>
  <div class="status error" *ngIf="!measurementActive && errorMessage">
    {{ errorMessage }}
  </div>
</div>
