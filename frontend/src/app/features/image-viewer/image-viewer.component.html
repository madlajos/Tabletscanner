<div class="image-viewer-container">
  <div class="top-bar">
    <div class="camera-name">
      Kamera
      <span class="status-indicator" [ngClass]="{
          'disconnected': !sharedService.getCameraConnectionStatus(),
          'connected': sharedService.getCameraConnectionStatus() && !sharedService.getCameraStreamStatus(),
          'streaming': sharedService.getCameraStreamStatus()
        }">
      </span>
      <label class="live-toggle" title="Live view on/off">
        <input type="checkbox" [checked]="liveViewVisible" (change)="liveViewVisible = !liveViewVisible" />
        <span class="live-toggle-slider"></span>
      </label>
    </div>
  </div>

  <div class="live-view">
    <div #videoContainer class="video-host" [class.hidden]="!sharedService.getCameraStreamStatus()" [style.visibility]="liveViewVisible ? 'visible' : 'hidden'" 
         [class.zoomed]="isZoomed()" 
         [style.cursor]="getCursorStyle()"></div>

    <button class="capture-button" (click)="captureImage()" [disabled]="!sharedService.getCameraStreamStatus() || isCaptureCooldown || !saveLocationValid"
      title="Felvétel készítése">
      <mat-icon>photo_camera</mat-icon>
    </button>
  </div>



</div>

@if (savedImages.length > 0) {
  <div class="gallery-container">
    <button class="clear-gallery-btn" (click)="clearGallery()" title="Galéria törlése">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
        <path d="M19.36 2.72l1.42 1.42-5.72 5.71c1.07 1.54 1.22 3.39.32 4.59L9.06 8.12c1.2-.9 3.05-.75 4.59.32l5.71-5.72zM5.93 17.57c-2.01-2.01-3.24-4.41-3.58-6.65l4.88-2.09 7.44 7.44-2.09 4.88c-2.24-.34-4.64-1.57-6.65-3.58z"/>
      </svg>
    </button>
    <div class="gallery-scroll">
      @for (img of savedImages; track img.path) {
        <div class="thumb"
             (click)="openImage(img)"
             (contextmenu)="onImageContextMenu($event, img)"
             title="{{ img.path }}">
          <img
            [src]="img.url"
            alt="saved image thumbnail"
            loading="lazy"
            decoding="async"
          />
        </div>
      }
    </div>
  </div>
}

<!-- Custom context menu -->
@if (contextMenuVisible) {
  <div class="context-menu" 
       [style.left.px]="contextMenuX"
       [style.top.px]="contextMenuY"
       (mouseleave)="hideContextMenu()">
    <div class="context-menu-item" (click)="contextMenuOpen()">
      <mat-icon>open_in_new</mat-icon>
      <span>Megnyitás</span>
    </div>
    <div class="context-menu-item" (click)="contextMenuOpenFolder()">
      <mat-icon>folder_open</mat-icon>
      <span>Mappa megnyitása</span>
    </div>
    <div class="context-menu-item" (click)="contextMenuDelete()">
      <mat-icon>delete</mat-icon>
      <span>Törlés</span>
    </div>
  </div>
}